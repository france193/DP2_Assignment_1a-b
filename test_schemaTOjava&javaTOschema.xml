<?xml version="1.0" encoding="UTF-8"?>

<project basedir="." default="Init" name="test-schemaTOjava_javaTOschema">
    <description>
        Script for generating Java classes from my schema and generating a schema from the java classes
    </description>

    <!-- defined property -->
    <property name="originalXsd" location="${basedir}/xsd/nffgInfo.xsd"/>

    <property name="testDir" location="${basedir}/test"/>
    <property name="generatedJavaDir" location="${basedir}/test/javaGeneratedFromXsd"/>
    <property name="generatedXsdDir" location="${basedir}/test/xsdGeneratedFromJavaClasses"/>
    <property name="generatedJavaClassesDir" location="${basedir}/test/classes"/>

    <property name="pkg" value="https.france193_wordpress"/>
    <property name="rootElementName" value="NetworkServices"/>
    <property name="annotatedMainClassName" value="${pkg}.${rootElementName}"/>

    <!-- debug property -->
    <property name="debug" value="true"/>
    <property name="debuglevel" value="source,lines,vars"/>

    <!-- target version and souce version of Java -->
    <property name="target" value="1.8"/>
    <property name="source" value="1.8"/>

    <!-- Target init -->
    <target name="Init">
        <mkdir dir="${testDir}"/>
        <mkdir dir="${generatedJavaDir}"/>
        <mkdir dir="${generatedXsdDir}"/>
        <mkdir dir="${generatedJavaClassesDir}"/>
    </target>

    <!-- Generate Java classes from xsd schema -->
    <target name="SchemaTOJava" depends="Init" description="Generates java classes from xsd schema">
        <echo message="Generating Java classes..."/>
        <exec executable="xjc">
            <arg value="-d"/>
            <arg value="${generatedJavaDir}"/>
            <arg value="${originalXsd}"/>
        </exec>
        <echo message="Compiling java source files..."/>
        <javac destdir="${generatedJavaClassesDir}" debug="${debug}"
               debuglevel="${debuglevel}" source="${source}" target="${target}"
               includeantruntime="false">
            <src path="${generatedJavaDir}"/>
        </javac>
    </target>

    <!-- Generate xsd schema from Java classes previous generated -->
    <target name="JavaTOschema" depends="Init,SchemaTOJava" description="Generates xsd schema from Java classes previous generated">
        <echo message="Generating xsd schema..."/>
        <exec executable="schemagen">
            <arg value="-d"/>
            <arg value="${generatedXsdDir}"/>
            <arg value="-cp"/>
            <arg value="${generatedJavaClassesDir}"/>
            <arg value="${annotatedMainClassName}"/>
        </exec>
        <!-- Rename xsd file from schema1.xsd to nffgInfo_autogen.xsd -->
        <move file="${generatedXsdDir}/schema1.xsd" tofile="${generatedXsdDir}/nffgInfo_autogen.xsd"/>
    </target>

    <!-- Clean -->
    <target name="Clean" description="Deletes all generated files.">
        <delete dir="${testDir}"/>
    </target>

</project>